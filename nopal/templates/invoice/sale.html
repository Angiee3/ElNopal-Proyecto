{% extends 'partials/body.html' %}
{% load crispy_forms_tags %}
{% block title %}Nueva Venta{% endblock title %}
{% load static %}
{% block contenido %}
 
<div>
    <section class="container  p-5 h-auto" id="mode-cards" data-admin id="cuerpo" style="width: 95%">
        <h1>Gestionar {{title_pag}}</h1>
        <div class="row my-4">
            <div class="col-md-4">
                <div class="border  p-3 rounded shadow mt-3" id="mode-cards">
                    <h3 class="text-start">Nuevo Registro </h3>
                    <form method = 'POST' action= '' enctype = "multipart/form-data" novalidate id = "sale-form">
                        {% csrf_token %}

                        <label for="sale-user" class="control-label">Empleado</label>
                        <div class="mt-3" >
                            <select class="form-select select2 select_hijo" id="select_name" aria-label="Default select example" name="opcion" >
                                {% for usuario  in res %}
                                <option value="{{usuario}}">{{usuario}}</option>
                                {% endfor %}
                            </select>
                          </div>
                        <a href="{% url 'm_register' %}" id="add_user" onclick="return showAddPopup(this);"><img src = "{% static 'img/icons/plus.svg' %}"></a>
                        <br>  


                        <div id="div_id_typeSale" class="mb-3"> 
                            <label for="id_typeSale" class="form-label requiredField">
                            Tipo de Venta
                            <span class="asteriskField">*</span> 
                        </label> 
                        {{form.typeSale }}
                    </div>

                        <label for="sale-payment" class="control-label">Método de pago</label>
                        {{form.payment }}

                        <div id="div_id_client" class="mb-3"> <label for="id_client" class="form-label">
                            Cliente
                        </label> 
                        <input type="text" name="client" value="Cliente local" class="form-control textinput textInput" maxlength="50" id="id_client"> </div>

                        <div id="div_id_nDocument" class="mb-3"> <label for="id_nDocument" class="form-label">
                            Número de Documento / NIT
                        </label> <input type="number" name="nDocument" value="1234567890" class="form-control numberinput" maxlength="20" id="id_nDocument"> </div>

                        <div id="div_id_address" class="mb-3"> <label for="id_address" class="form-label">
                            Dirección
                        </label> <input type="text" name="address" value="Local" class="form-control textinput textInput" maxlength="254" id="id_address"> </div> 


                        <input type="hidden" id="modal-status" value="Agregar">
                        <button class="btn_agregar d-block m-auto text-center text-decoration-none py-1 rounded border border-none"
                        style="width: 120px;" data-bs-toggle="tooltip" data-bs-placement="right" title="Agregar a la venta">Agregar</button>

                    </form>
                </div>
            </div>
            <div class="col-md-8">
                <table id="tabla" class="display table table-striped table-hover text-nowrap mt-3" style="width:100%">
                    <thead style="background-color: var(--verde); color: var(--verdeoscuro);">
                        <tr>
                            <th scope="col">Fecha</th>
                            <th scope="col">Encargado</th>
                            <th scope="col">Método de Pago</th>
                            <th scope="col">Estado</th>
                            <th scope="col">Información</th>
                            <th scope="col">Acciones</th>
                        </tr>
                    </thead>

                    <tbody>
                    {% for register in registers %}
                            {% if register.status %}
                                <tr>
                                    <td id="texto">{{register.date}}</td>
                                    <td id="texto">{{usuario}}</td>
                                    <td id="texto">{{register.payment}}</td>
                                    <td id="texto">{{register.status}}</td>
                                    <td id="texto">{{register.client.title}} - {{register.nDocument}}/{{register.address}}</td>
                                    <td id="texto">{% if register.status == "Abierta" %}
                                        <a href="" class="btn btn-md border"><img class="img-fluid" src="{% static 'img/icons/update.svg' %}" id="edit" alt=""></a>
                                        {% if user.is_staff %}
                                        <a href="" class="btn btn-md border"><img class="img-fluid" src="{% static 'img/icons/delete.svg' %}" id="eliminar" alt=""></a>
                                        {% endif %}
                                        <a href="{% url 'sale-detail' pk=register.id %}" class="btn btn-md border"><img class="img-fluid" src="{% static 'img/icons/plus.svg' %}" alt=""></a> 
                                    {% elif register.status == "Cerrada" %}
                                        <a href="" class="btn btn-md border"><img class="img-fluid" src="{% static 'img/icons/eye.svg' %}" alt=""></a> 
                                    {% elif register.status ==  "Anulada" %}
                                        <p>Está factura se encuentra anulada</p>
                                    {% endif %}
                                </td>    
                                </tr>
                            {% endif %}
                    {% endfor %}
                    </tbody> 

                </table>
                {% if messages %}
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                    <strong>{{ message }}</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
                {% endif %}

            </div>
        </div>
    </section>
</div>

{% include 'partials/accesibilidad.html' %}
 {% endblock %}